<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <th:block th:replace="fragments/header :: header-css"/>
  <!-- Custom styles for this template -->
  <link rel="stylesheet" th:href="@{css/signin-register.css}" type="stylesheet"/>
</head>
<body>
<div th:replace="fragments/header :: menu(activeTab='classroom')"/>

<main class="mx-auto" style="width: 350px;">
   <div class="card">
     <div class="card-header">
    <p style="text-align: center" th:text="#{add.classroom}"></p>
     </div>

    <div class="card-body" >
      <form action="#" th:action="@{/classroom/add}" th:object="${classroomDto}" method="post" >
        <div class="mb-4">
        <label for="name" class="form-label">Name</label>
        <input type="text" th:field="*{name}" id="name" placeholder="name" class="form-control">
        <span th:if="${#fields.hasErrors('name')}" th:errors="*{name}" class="validation-message"></span>
        </div>
        <hr>
        <p style="text-align: center" th:text="#{add.scope}"></p>
<!--        <div th:replace="fragments/add-scope (indice=0)"/>-->
        <div id="div-scopes" th:unless="${#lists.isEmpty(classroomDto.scopes)}">
          <ul class="items_prototype" id="items_prototype" style="list-style-type: none;"
              data-prototype=" &lt;div&gt;
    &lt;div class=&quot;mb-4&quot;&gt;
          &lt;label for=&quot;scope__name__&quot; class=&quot;form-label&quot;&gt;Thème&lt;/label&gt;
          &lt;input type=&quot;text&quot; placeholder=&quot;scope&quot; class=&quot;form-control&quot; id=&quot;scope__name__&quot;
           name=&quot;scopes[__name__]&quot; value=&quot;Scope__name__&quot;/&gt;
          &lt;/div&gt;
          &lt;/div&gt;"
          >
          <li th:each="scope,iterStat : ${classroomDto.scopes}">
            <div th:replace="fragments/add-scope (indice=${iterStat.index})"/>
          </li>
          </ul>
        </div>
        <hr>
        <div class="mb-4">
          <span class="p-1"><a href="#" th:text="#{cancel}">Retour</a></span>
          <button type="submit" class="btn btn-primary btn-block" th:text="#{submit}">Ajouter</button>
        </div>
      </form>
    </div>
   </div>
</main>

<div th:replace="fragments/footer.html :: footer"/>

<script>
  // Récupère le div qui contient la collection de scopes
  var listScopes = document.getElementById('items_prototype');
  var addScopeLinkElt = document.createElement('a');
  addScopeLinkElt.setAttribute('href', '#');
  addScopeLinkElt.setAttribute('class', 'add_scope_link');
  addScopeLinkElt.innerHTML = "Add a scope";

  var newP = document.createElement('p');
  var divscopes = document.getElementById('div-scopes');
  newP.appendChild(addScopeLinkElt);
  divscopes.appendChild(newP);

  window.addEventListener("DOMContentLoaded", (event) => {
    // ajoute un lien de suppression à tous les éléments li de
    // formulaires des scopes existants
    let scopeFormLis = listScopes.getElementsByTagName('li');
    for (let i = 0; i < scopeFormLis.length; i++) {
      addScopeFormDeleteLink(scopeFormLis[i]);
    }
   });

  function addScopeFormDeleteLink(scopeFormLi) {
    // <a href="#">Delete this scope</a>;
    // with onclick handler
    // let removeFormA = document.createElement('a');
    // removeFormA.setAttribute('href', '#');
    // removeFormA.innerHTML = "Delete this scope";
    // scopeFormLi.appendChild(removeFormA);

    let scopeDelete = scopeFormLi.getElementsByClassName("scope-delete");
    // one item by li
    scopeDelete[0].onclick = function (e) {
      // empêche le lien de créer un « # » dans l'URL
      e.preventDefault();
      // supprime l'élément li (scope)
      scopeFormLi.remove();
    };
  }

</script>

</body>
</html>
